function messageReadCount(b,a,c){$.ajax({type:"post",url:"ajax.php",data:{uid:b,type:a,bh:c},dataType:"json",success:function(d){$("#receive-newcounts").text(d.data.unReadCount);window.parent.frames["header"].document.getElementById("message_num").innerHTML=d.data.unReadCount},error:function(){console.log("error")}})}function messageHandler(j,q,f,p,h,r,k,g,b,m){$.post("ajax.php",{uid:j,type:q,mid:f,msgType:p,msgTitle:h,msgContent:r,addpople:k,ids:g,page:b,pageNum:m},function(a){if(q=="send"){dialog({title:"消息",content:'<div class="tips-content send-ok">'+a+"</div>",fixed:!0,okValue:"确定",ok:function(){}}).showModal()}else{}})}$(document).ready(function(){var f=$(".m-module"),d=$(".m-item");f.children().each(function(a){$(this).click(function(){messageHandler($(this).data("user-id"),$(this).data("type")),$(this).removeClass().addClass("active").siblings().removeClass(),d.removeClass("active").eq(a).addClass("active")})}),$("#allIn").click(function(){$("#inbox").find("input[name='Id']").prop("checked",$(this).prop("checked"))}),$("#inboxDel").click(function(){var a="";if($("#inbox").find("input[name='Id']").each(function(){this.checked&&(a+=""==a?$(this).val():","+$(this).val())}),""==a){return dialog({title:"提示",content:'<div class="tips-content">没有要删除的消息</div>',fixed:!0,okValue:"确定",ok:function(){}}).showModal(),!1}messageHandler($userId,"delete",0,"","","","",a),messageHandler($userId,"get")}),$("#allOut").click(function(){$("#outbox").find("input[name='Id']").prop("checked",$(this).prop("checked"))}),$("#outboxDel").click(function(){var a="";if($("#outbox").find("input[name='Id']").each(function(){this.checked&&(a+=""==a?$(this).val():","+$(this).val())}),""==a){return dialog({title:"提示",content:'<div class="tips-content">没有要删除的消息</div>',fixed:!0,okValue:"确定",ok:function(){}}).showModal(),!1}messageHandler($userId,"delete",0,"","","","",a),messageHandler($userId,"getS")});var g=$("#btn-send"),b=($("#msgType"),$("#msgTitle")),c=$("#msgContent");$("#addpople");g.click(function(){if(""==b.val()){return dialog({title:"提示",content:'<div class="tips-content">标题不能为空</div>',fixed:!0,okValue:"确定",ok:function(){}}).showModal(),!1}if(""==c.val()){return dialog({title:"提示",content:'<div class="tips-content">内容不能为空</div>',fixed:!0,okValue:"确定",ok:function(){}}).showModal(),!1}var h=$('select[name="msgType"]').val(),a=$('input[name="msgTitle"]').val(),i=$('input[name="addpople"]').val();return messageHandler(0,"send",0,h,a,$('textarea[name="msgContent"]').val(),i),$("#msgTitle").val(""),$("#msgContent").val(""),!1}),$(document).on("click","#inbox .mcj_j",function(){var a=$(this).find("a");dialog({title:"消息",content:'<dl class="msg-content"><dt><h1>'+$(a).data("title")+"</h1><p>时间："+$(a).data("time")+"</p></dt><dd>"+$(a).data("content")+"</dd></dl>",fixed:!0,okValue:"关闭",ok:function(){}}).showModal();$(this).parents(".sxx_li").addClass("mem_readed");messageReadCount($userId,"readinbox",$(a).data("id"))}),$(document).on("click","#outbox .mcj_j",function(){var h=$(this).find("a");var i=$(h).data("id");var a={type:"opensendmail",bh:i,uid:$userId};$.ajax({url:"ajax.php",type:"POST",dataType:"json",data:a,success:function(e){var j="";$.each(e,function(k,l){if(l.isAdmin==0){j+='<dl class="msg-content"><dt><p>You&nbsp;&nbsp;'+l.time+"</p></dt><dd>"+l.message+"</dd></dl><br/>"}if(l.isAdmin==1){if(k==0){j+='<dl class="msg-content"><dt><p>Admin[回复]&nbsp;&nbsp;'+l.time+"</p></dt><dd>"+l.message+"&nbsp;&nbsp;<a data-tid="+l.topid+" data-id="+l.lastid+' href="javascript:void(0);" id="replayToAdmin"><font color="blue">[回复管理员]</font></a></dd></dl><br/>'}else{j+='<dl class="msg-content"><dt><p>Admin[回复]&nbsp;&nbsp;'+l.time+"</p></dt><dd>"+l.message+"</dd></dl><br/>"}}});dialog({title:$(h).data("title"),content:j,fixed:!0,okValue:"关闭",ok:function(){}}).showModal()}})})}),Date.prototype.pattern=function(b){var a={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var c in /(y+)/.test(b)&&(b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(b)&&(b=b.replace(RegExp.$1,(1<RegExp.$1.length?2<RegExp.$1.length?"/u661f/u671f":"/u5468":"")+{0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"}[this.getDay()+""])),a){new RegExp("("+c+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?a[c]:("00"+a[c]).substr((""+a[c]).length)))}return b};$(document).on("click","#replayToAdmin",function(){var b=$(this).data("id");var a=$(this).data("tid");$(this).parents("tr").next().find("button").trigger("click");dialog({title:"回复管理员",content:'<textarea class="mcj_t" name="msgContent" id="replayContent" maxlength="1000" placeholder="请详细描述您要咨询的问题，我们的客服人员会及时的回复您的消息，谢谢！（限1000个中文字符）"></textarea>',fixed:!0,okValue:"确定回复",ok:function(){var c=$("#replayContent").val();var d={type:"replaysendmail",id:b,tid:a,text:c,uid:$userId};$.ajax({url:"ajax.php",type:"POST",dataType:"json",data:d,success:function(e){dialog({title:"消息",content:'<div class="tips-content send-ok">'+e.message+"</div>",fixed:!0,okValue:"确定",ok:function(){}}).showModal()
        }})}}).showModal()});