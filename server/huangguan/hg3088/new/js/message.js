function messageHandler(e,t,n,a,i,s,d,l,o,c){$.post("ajax.php",{uid:e,type:t,mid:n,msgType:a,msgTitle:i,msgContent:s,addpople:d,ids:l,page:o,pageNum:c},function(e){"get"!=t&&"getS"!=t||messageGet(e,t)})}function messageGet(e,t){var n="",a="",i="",s=$(e[0]).size();n="getS"==t?$("#outbox > .mcj_g"):$("#inbox > .mcj_g"),0==s&&(a='<h3 class="message-no">您还未有任何信息哦~</h3>',n.append(a)),n.html(""),"getS"!=t&&($unreadMsg=e.unReadCount,$("#receive-newcounts").html($unreadMsg));for(var d=0;d<s;d++){var l="";0==e[0][d].user_read&&(l="unread"),$title_type=e[0][d].title_type,1==$title_type?$title_typev="财务问题":2==$title_type?$title_typev="技术问题":3==$title_type?$title_typev="业务咨询":4==$title_type?$title_typev="意见建议":5==$title_type?$title_typev="其他问题":$title_typev=$title_type;var o=e[0][d].addtime,c=new Date(1e3*o).pattern("yyyy-MM-dd HH:mm:ss");a+="getS"==t?'<li><div class="clearfix"><div class="mcj_h"><input type="checkbox" name="Id" value="'+e[0][d].id+'"></div><div class="mcj_j"><a href="#" data-title="'+e[0][d].title+"\" data-content='"+e[0][d].content+"' data-time='"+c+"' data-id=\""+e[0][d].id+'">'+e[0][d].title+'</a></div><div class="mcj_k">'+c+"</div></div></li>":'<li class="'+l+'"><div class="clearfix"><div class="mcj_h"><input type="checkbox" name="Id" value="'+e[0][d].id+'"></div><div class="mcj_i"></div><div class="mcj_j"><a href="#" data-title="'+e[0][d].title+"\" data-content='"+e[0][d].content+"' data-time='"+c+"' data-id=\""+e[0][d].id+'">'+e[0][d].title+'</a></div><div class="mcj_k">'+c+"</div></div></li>"}$(".mcj_l").show(),i+="getS"==t?"当前第&nbsp;&nbsp;<select id='chgSPage'>":"当前第&nbsp;&nbsp;<select id='chgPage'>";for(d=1;d<=e.pages;d++)i+="<option value='"+d+"'",d==e.page&&(i+="selected"),i+=">"+d+"</option>";i+="</select>&nbsp;&nbsp;页&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",i+="共<em>"+e.pages+"</em>页&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",i+="共<em>"+e.count+"</em>条记录","getS"==t?($("#outboxPage").html(""),$("#outboxPage").append(i)):($("#inboxPage").html(""),$("#inboxPage").append(i)),n.append(a)}$(document).ready(function(){messageHandler($userId,"get");var e=$(".m-module"),t=$(".m-item");e.children().each(function(e){$(this).click(function(){messageHandler($(this).data("user-id"),$(this).data("type")),$(this).removeClass().addClass("active").siblings().removeClass(),t.removeClass("active").eq(e).addClass("active")})}),$("#allIn").click(function(){$("#inbox").find("input[name='Id']").prop("checked",$(this).prop("checked"))}),$("#inboxDel").click(function(){var e="";if($("#inbox").find("input[name='Id']").each(function(){this.checked&&(e+=""==e?$(this).val():","+$(this).val())}),""==e)return dialog({title:"提示",content:'<div class="tips-content">没有要删除的消息</div>',fixed:!0,okValue:"确定",ok:function(){}}).showModal(),!1;messageHandler($userId,"delete",0,"","","","",e),messageHandler($userId,"get")}),$("#allOut").click(function(){$("#outbox").find("input[name='Id']").prop("checked",$(this).prop("checked"))}),$("#outboxDel").click(function(){var e="";if($("#outbox").find("input[name='Id']").each(function(){this.checked&&(e+=""==e?$(this).val():","+$(this).val())}),""==e)return dialog({title:"提示",content:'<div class="tips-content">没有要删除的消息</div>',fixed:!0,okValue:"确定",ok:function(){}}).showModal(),!1;messageHandler($userId,"delete",0,"","","","",e),messageHandler($userId,"getS")});var n=$("#btn-send"),a=($("#msgType"),$("#msgTitle")),i=$("#msgContent");$("#addpople");n.click(function(){if(""==a.val())return dialog({title:"提示",content:'<div class="tips-content">标题不能为空</div>',fixed:!0,okValue:"确定",ok:function(){}}).showModal(),!1;if(""==i.val())return dialog({title:"提示",content:'<div class="tips-content">内容不能为空</div>',fixed:!0,okValue:"确定",ok:function(){}}).showModal(),!1;dialog({title:"消息",content:'<div class="tips-content send-ok">已收到您的消息，我们尽快回复。谢谢！</div>',fixed:!0,okValue:"确定",ok:function(){}}).showModal();var e=$('select[name="msgType"]').val(),t=$('input[name="msgTitle"]').val(),n=$('input[name="addpople"]').val();return messageHandler(0,"send",0,e,t,$('textarea[name="msgContent"]').val(),n),$("#msgTitle").val(""),$("#msgContent").val(""),!1}),$(document).on("click","#inbox .mcj_j",function(){var e=$(this).find("a");dialog({title:"消息",content:'<dl class="msg-content"><dt><h1>'+$(e).data("title")+"</h1><p>时间："+$(e).data("time")+"</p></dt><dd>"+$(e).data("content")+"</dd></dl>",fixed:!0,okValue:"关闭",ok:function(){}}).showModal(),$(e).parent().parent().parent().removeClass("unread"),messageHandler(0,"read",$(e).data("id")),messageHandler($userId,"get")}),$(document).on("click","#outbox .mcj_j",function(){var e=$(this).find("a");dialog({title:"消息",content:'<dl class="msg-content"><dt><h1>'+$(e).data("title")+"</h1><p>时间："+$(e).data("time")+"</p></dt><dd>"+$(e).data("content")+"</dd></dl>",fixed:!0,okValue:"关闭",ok:function(){}}).showModal()}),$(document).on("change","#chgPage",function(){var e=$(this).val();messageHandler($userId,"get",0,"","","","","",e,5)}),$(document).on("change","#chgSPage",function(){var e=$(this).val();messageHandler($userId,"getS",0,"","","","","",e,5)})}),Date.prototype.pattern=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(1<RegExp.$1.length?2<RegExp.$1.length?"/u661f/u671f":"/u5468":"")+{0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"}[this.getDay()+""])),t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e};